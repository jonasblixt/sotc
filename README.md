All of this stuff is now integrated into uFSM:
https://github.com/jonasblixt/ufsm
